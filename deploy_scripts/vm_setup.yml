---
- name: Configures a VM to host a static HTML website
  hosts: local_vm
  tasks:
  - name: Check server availability
    ping:
  - name: Install packages
    yum:
      name:
        - httpd
        - php
      state: latest
    register: httpd_installation
  - name: Enable httpd (start on boot)
    service:
      name: httpd
      enabled: yes
  - name: Change permissions to '775' for /var/www/html/ directory
    file:
      path: /var/www/html/
      recurse: yes
      mode: '775'
  - name: Copy httpd configuration
    synchronize:
      src: httpd.conf
      dest: "{{ ansible_user }}@{{ ansible_host }}:/etc/httpd/conf/httpd.conf"
      dest_port: "{{ ansible_ssh_port }}"
    register: httpd_configuration
  - name: Restart httpd
    service:
      name: httpd
      state: restarted
    when: httpd_installation.changed or httpd_configuration.changed
  - name: Set firewall zone to 'FedoraServer' on machines running Fedora
    set_fact:
      firewall_zone: FedoraServer
    when: ansible_distribution == 'Fedora'
  - name: Add HTTP traffic to firewall
    firewalld:
      zone: "{{ firewall_zone }}"
      service: http
      permanent: yes
      immediate: yes
      state: enabled